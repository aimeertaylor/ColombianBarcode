# ColombianBarcode

To reproduce the work in the manuscript entitled "Identity-by-descent relatedness estimates with uncertainty characterise departure from isolation-by-distance between *Plasmodium falciparum* populations on the Colombian-Pacific coast" using processed data (SNPData.RData and hmmInput.txt generated by DataFormat.R; and LonLat.RData, geo_dist_info_states.RData, and geo_dist_info_cities.RData generated by Generate_geo_dist_info.R) complete the following four steps.

1. Set the working directory to ColombianBarcode/Code

2. Run Generate_mles_CIs.R (SLOW, outputs mles_CIs.RData)

3. Run Format_mle_df.R (outputs All_results.RData)

4. Run in no particular order

- Generate_transportdistances_city.R (outputs All_W_results_c.RData)
- Generate_proportions.R (outputs proportions_time.RData and proportions_geo.RData)
- Generate_proportions_sensitivity.R (outputs proportions_sensitivities.RData)

5. Run in no particular order

- Plot_proportions_distances.R (outputs Proportions_and_W_distance.pdf)
- Plot_proportions_sensitivity.R (outputs Proportions_sensitivity.pdf)
- Plot_graph_components.R (outputs All_CCs.pdf, Graphs_timespace.pdf and Graphs.pdf)
- Knit to PDF Data_summary.Rmd (outputs Data_summary.pdf)

# Extended analysis 
Follow the following steps to reproduce the extended analaysis (see Code/Extended_analysis/Analysis_summary.pdf for more details). From within Code/Extended_analysis/
- Run Format_metadata_extended.R
- Run Format_snpdata_extended.R
- Run Generate_mles_CIs_extended.R
- Run Checking_mles.R to check mles against those of Taylor et al. 2020 and to check for any inconsistencies in lower confidence interval limits near zero
- Run Filter_mles_CIs_extended.R to filter problematic clonal estimates
- Run Format_mles_CIs_extended.R to add metadata to relatedness estimates
- Run Generate_sids_remv.R to generate a list of samples with one or more NA comparisons. These are samples that need removing before generating graphs
- Run Generate_components.R  
- Run Generate_relatedness_to_CCs.R to compute average relatedness between old CCs and new samples and between old CCs and CCs based on new samples only
- Run Compare_components.R to see how the extended data set clonally clusters with clonal components reported in Taylor et al. 2020.
- Run Plot_relatedness_graph.R and Plot_relatedness_to_CCs.R
- Run Generate_and_plot_connectivity.R
- Run Analysis_summary.Rmd to summarise data on which analyses were done 

Other files include summarise_mles.R (used in Filter_mles_CIs_extended.R and Generate_sids_remv.R) and generate_counts_table.R (used in Analysis_summary.Rmd); scripts to-do with data checking (Check_snpname_order_hypothesis.R); and scripts in Archive, which are obsolete but kept for reference. 

# Re-do Taylor et al. to check clonal components
# Re-do Taylor et al. to check LCI of clones

# Notes-to-self (for post-pandemic)
- !.gitignore "../GISData/CP_coast.shp" and re-add Plot_network.R (outputs Colombia_network%d.png and Colombia_Map.png) 
- ensure ignored files are synced across work and personal laptops and finalise .gitignore
- check work laptop notes on Effect of COI and transmission intensity (duplicate analysis?)

